<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://vjs.zencdn.net/7.21.0/video-js.css" rel="stylesheet" />
        <!-- Tambahkan plugin source selector untuk kualitas video -->
        <link rel="stylesheet" href="https://unpkg.com/videojs-http-source-selector/dist/videojs-http-source-selector.css" />
        <title>Video.js Loop Example</title>
        <style>
            /* Custom styles for the progress bar */
            #progress-container {
                width: 640px;
                height: 10px;
                background-color: #ddd;
                margin-top: 20px;
                cursor: pointer;
                margin-bottom: 40px;
                border-radius: 5px;
            }

            #progress-bar {
                height: 100%;
                width: 0;
                background-color: #d50707;
                border-radius: 5px; /* Rounded corners for bar */
            }

            /* Button styling */
            button {
                margin-right: 10px;
                padding: 10px 20px;
                font-size: 16px;
            }
        </style>
    </head>
    <body>
        <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" width="640" height="264" data-setup="{}">
            <source src="video1280.mp4" type="video/mp4" label="1080p" />
            <source src="video750.mp4" type="video/mp4" label="720p" />
        </video>

        <!-- Custom progress bar container -->
        <div id="progress-container">
            <div id="progress-bar"></div>
            <p>Current Time: <span id="current-time">0:00</span> / Total Duration: <span id="total-duration">0:00</span></p>
        </div>
        <button id="loop-button">Loop Video: Off</button>
        <button id="play-pause-button">Play</button>
        <button id="backward-button">Back 10s</button>
        <button id="forward-button">Forward 10s</button>
        <!-- Dropdown selector outside video container -->
        <div>
            <label for="quality-selector">Select Video Quality:</label>
            <select id="quality-selector">
                <option value="1080p">1080p</option>
                <option value="720p">720p</option>
                <option value="480p">480p</option>
            </select>
        </div>
        <button id="fullscreen-button">Fullscreen</button>
        <!-- Ganti dengan icon kamu -->

        <script src="https://vjs.zencdn.net/7.21.0/video.min.js"></script>
        <script src="https://unpkg.com/videojs-http-source-selector/dist/videojs-http-source-selector.min.js"></script>

        <script>
            var player = videojs("my-video");

            // KUALITAS VIDEO
            player.httpSourceSelector(); // Panggil plugin hanya sekali
            // Ketika video siap, pilih kualitas default
            player.on("ready", function () {
                var qualitySelector = document.getElementById("quality-selector");
                // Ubah kualitas berdasarkan pilihan dropdown
                qualitySelector.addEventListener("change", function () {
                    var selectedQuality = qualitySelector.value;
                    var sources = player.tech().el().getElementsByTagName("source");
                    // Loop untuk menemukan kualitas yang dipilih
                    for (var i = 0; i < sources.length; i++) {
                        if (sources[i].getAttribute("label") === selectedQuality) {
                            // Set video dengan source yang sesuai dan mainkan
                            player.src({ src: sources[i].src, type: "video/mp4" });
                            player.play();
                            break;
                        }
                    }
                });
            });

            var loopEnabled = false; // Initial state of loop
            var loopButton = document.getElementById("loop-button");
            var playPauseButton = document.getElementById("play-pause-button");
            var progressContainer = document.getElementById("progress-container");
            var progressBar = document.getElementById("progress-bar");
            var backwardButton = document.getElementById("backward-button");
            var forwardButton = document.getElementById("forward-button");
            var isMouseDown = false;

            // LOOP VIDEO
            // Toggle loop state when button is clicked
            loopButton.addEventListener("click", function () {
                loopEnabled = !loopEnabled;
                loopButton.textContent = `Loop Video: ${loopEnabled ? "On" : "Off"}`;
            });
            // Listen for video end event
            player.on("ended", function () {
                if (loopEnabled) {
                    player.currentTime(0); // Restart the video
                    player.play(); // Play again
                }
            });

            // PLAY/PAUSE VIDEO
            playPauseButton.addEventListener("click", function () {
                if (player.paused()) {
                    player.play();
                    playPauseButton.textContent = "Pause";
                } else {
                    player.pause();
                    playPauseButton.textContent = "Play";
                }
            });

            // BACK 10 SECONDS
            backwardButton.addEventListener("click", function () {
                var newTime = player.currentTime() - 10;
                player.currentTime(Math.max(newTime, 0)); // Ensure time doesn't go below 0
            });

            // FORWARD 10 SECONDS
            forwardButton.addEventListener("click", function () {
                var newTime = player.currentTime() + 10;
                player.currentTime(Math.min(newTime, player.duration())); // Ensure time doesn't go past the video length
            });

            // Update progress bar based on current video time
            player.on("timeupdate", function () {
                if (!isMouseDown) {
                    // Prevent progress from updating while dragging
                    var progress = (player.currentTime() / player.duration()) * 100;
                    progressBar.style.width = progress + "%";
                }
            });
            // Mouse down event to start dragging
            progressContainer.addEventListener("mousedown", function (e) {
                isMouseDown = true;
                var rect = progressContainer.getBoundingClientRect();
                startX = e.clientX - rect.left; // Simpan posisi horizontal awal
                updateProgress(e);
            });
            // Mouse up event to stop dragging
            document.addEventListener("mouseup", function () {
                isMouseDown = false;
            });
            // Mouse move event to update progress bar in real-time
            progressContainer.addEventListener("mousemove", function (e) {
                if (isMouseDown) {
                    // Pada mouse move, tetap gunakan posisi horizontal awal (startX)
                    e.clientX = startX + (e.movementX || 0); // Gunakan pergeseran horizontal dari gerakan mouse
                    updateProgress(e);
                }
            });
            // Right-click handler (context menu block)
            progressContainer.addEventListener("contextmenu", function (e) {
                e.preventDefault(); // Prevent context menu from appearing
                isMouseDown = true;
                updateProgress(e);
            });
            // Function to update progress and set video time
            function updateProgress(e) {
                var rect = progressContainer.getBoundingClientRect();
                var offsetX = e.clientX - rect.left;
                var progress = Math.max(0, Math.min(1, offsetX / progressContainer.offsetWidth));
                progressBar.style.width = progress * 100 + "%";
                player.currentTime(progress * player.duration());
            }

            // DETIK MENIT VIDEO
            var currentTimeDisplay = document.getElementById("current-time");
            var totalDurationDisplay = document.getElementById("total-duration");
            // Fungsi untuk memformat waktu menjadi 'MM:SS'
            function formatTime(seconds) {
                var minutes = Math.floor(seconds / 60);
                var seconds = Math.floor(seconds % 60);
                return minutes + ":" + (seconds < 10 ? "0" + seconds : seconds);
            }
            // Event listener saat video siap untuk dimainkan (durasi tersedia)
            player.on("loadedmetadata", function () {
                var totalDuration = player.duration();
                totalDurationDisplay.textContent = formatTime(totalDuration); // Tampilkan total durasi
            });
            // Event listener untuk memperbarui waktu saat ini saat video diputar
            player.on("timeupdate", function () {
                var currentTime = player.currentTime();
                currentTimeDisplay.textContent = formatTime(currentTime); // Tampilkan waktu saat ini
            });

            // FULLSCREEN VIDEO
            // Ambil elemen tombol fullscreen
            var fullscreenButton = document.getElementById("fullscreen-button");
            // Event listener untuk toggle fullscreen
            fullscreenButton.addEventListener("click", function () {
                if (!document.fullscreenElement) {
                    player.requestFullscreen(); // Masuk ke mode fullscreen
                    fullscreenButton.textContent = "Exit Fullscreen"; // Ubah teks tombol menjadi "Exit Fullscreen" atau ganti dengan icon lain
                } else {
                    document.exitFullscreen(); // Keluar dari mode fullscreen
                    fullscreenButton.textContent = "Fullscreen"; // Ubah kembali ke "Fullscreen" atau icon default
                }
            });
            // Mendengarkan perubahan state fullscreen
            player.on("fullscreenchange", function () {
                if (player.isFullscreen()) {
                    fullscreenButton.textContent = "Exit Fullscreen"; // Ubah teks saat fullscreen
                } else {
                    fullscreenButton.textContent = "Fullscreen"; // Kembalikan teks ketika keluar dari fullscreen
                }
            });
        </script>
    </body>
</html>
